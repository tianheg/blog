<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-02-08 Tue 11:01 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>自动发布 Org Mode</title>
<meta name="generator" content="Org mode">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/styles/base16/dracula.min.css">
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/highlight.min.js"></script>
<link rel="stylesheet" href="/theme/site.css"/>
<script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "d5b841b503ed4d1b8fad459b84d1cc2f"}'></script>
<script defer src="/theme/main.js"></script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">自动发布 Org Mode</h1>
</header><p>
使用了 crontab。
</p>

<div class="org-src-container">
<pre class="src src-sh">crontab -e
</pre>
</div>

<p>
通过默认编辑器打开一个空白文件，输入：
</p>

<div class="org-src-container">
<pre class="src src-text">@hourly ~/org/publish.sh &gt;&gt; /home/$USER/cron.log 2&gt;&amp;1
</pre>
</div>

<p>
这行文本的作用：
</p>

<ol class="org-ol">
<li>每个小时（整点，如 1 点，2 点……）会执行后面紧跟着的 shell 脚本，要确保脚本可执行（ <code>chmod +x ~/org/publish.sh</code> ）</li>
<li>日志输出到 <code>/home/$USER/cron.log</code></li>
</ol>

<p>
<code>~/org/publish.sh</code> 内容：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ddbc91;">\\</span>#!/bin/bash <span style="color: #706565;"># </span><span style="color: #857575;">&#35813;&#34892;&#22312;&#23454;&#38469;&#20351;&#29992;&#26102;&#65292;&#21482;&#26377; #!/bin/bash</span>
<span style="color: #706565;"># </span><span style="color: #857575;">&#22914;&#26524;&#19981;&#21152;\\&#65292;&#23548;&#20986;&#30340; html &#25991;&#20214;&#20013;&#26080;&#27861;&#26174;&#31034;#</span>

<span style="color: #706565;"># </span><span style="color: #857575;">&#22914;&#26524;&#27809;&#26377;&#19979;&#38754;&#36825;&#19968;&#34892;&#65292;&#23601;&#19981;&#33021;&#36890;&#36807; publickey push &#21040;&#36828;&#31243;&#20179;&#24211;</span>
<span style="color: #9fbfdf;">export</span> <span style="color: #aaca86;">GIT_SSH_COMMAND</span>=<span style="color: #ddbc91;">"ssh -i /home/$USER/.ssh/private_key"</span>
<span style="color: #9fbfdf;">cd</span> ~/repo/blog/
make publish
</pre>
</div>

<p>
如上述代码中注释所说，通过 cronie 自动化程序，似乎没办法读取到当前用户的私匙，这可能是为了安全。
</p>

<p>
我直接添加环境变量的解决办法会不会导致安全问题呢？
</p>

<p>
致谢：
</p>

<ol class="org-ol">
<li><a href="https://chai-bapat.medium.com/how-to-automate-github-using-cron-16effc825bcf">How to automate Github using Cron?</a></li>
<li><a href="https://git-scm.com/docs/git#Documentation/git.txt-codeGITSSHCOMMANDcode">GIT_SSH_COMMAND - git Documentation</a></li>
</ol>
</div>
</body>
</html>