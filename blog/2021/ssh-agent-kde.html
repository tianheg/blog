<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2022-02-06 Sun 16:37 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KDE 开机自启 ssh agent，加载密匙</title>
<meta name="generator" content="Org mode">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/styles/base16/dracula.min.css">
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/highlight.min.js"></script>
<link rel="stylesheet" href="/theme/site.css"/>
<script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "d5b841b503ed4d1b8fad459b84d1cc2f"}'></script>
<script defer src="/theme/main.js"></script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">KDE 开机自启 ssh agent，加载密匙</h1>
</header><ol class="org-ol">
<li><a href="https://wiki.archlinux.org/title/KDE_Wallet#Using_the_KDE_Wallet_to_store_ssh_key_passphrases">Using the KDE Wallet to store ssh key passphrases</a></li>
<li><a href="https://dev.to/manekenpix/kde-plasma-ssh-keys-111e">KDE Plasma &amp; ssh keys</a></li>
</ol>

<p>
<a href="https://userbase.kde.org/KDE_Wallet_Manager">Kwallet</a> 是 Linux 桌面管理器 KDE 下的一款管理密码的应用。
</p>

<div id="outline-container-org295b6f2" class="outline-2">
<h2 id="org295b6f2">Kwallet</h2>
<div class="outline-text-2" id="text-org295b6f2">
<p>
创建一个新钱包，并为它设置密码。
</p>
</div>
</div>

<div id="outline-container-orgef4c8c5" class="outline-2">
<h2 id="orgef4c8c5">开机启动 ssh-agent</h2>
<div class="outline-text-2" id="text-orgef4c8c5">
<p>
确保安装了 <a href="https://github.com/KDE/ksshaskpass">Ksshaskpass</a>。
</p>

<p>
新建文件 <code>~/.config/plasma-workspace/env/ssh-agent-startup.sh</code> ：
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #706565;">#</span><span style="color: #857575;">!/bin/</span><span style="color: #91a0b3;">sh</span>

<span style="color: #9fbfdf;">eval</span> <span style="color: #ddbc91;">"$(ssh-agent -s)"</span>
</pre>
</div>

<p>
通过 KDE 的系统设置中 Autostart 设置， <code>Add Login Script</code> 。添加新建的这个文件，之后会自动生成文件 <code>~/.config/autostart/ssh-agent-startup.sh.desktop</code> 。
</p>

<p>
不要忘记让 Shell 文件可执行：
</p>

<div class="org-src-container">
<pre class="src src-sh">sudo chmod +x ~/.config/plasma-workspace/env/ssh-agent-startup.sh
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf2a295" class="outline-2">
<h2 id="orgdf2a295">开机添加 ssh 密匙</h2>
<div class="outline-text-2" id="text-orgdf2a295">
<p>
新建文件 <code>~/.config/autostart/ssh-add.desktop</code> ：
</p>

<div class="org-src-container">
<pre class="src src-conf">[<span style="color: #ad8572;">Desktop Entry</span>]
<span style="color: #aaca86;">Exec</span>=ssh-add ~/.ssh/key
<span style="color: #aaca86;">Name</span>=ssh-add
<span style="color: #aaca86;">Type</span>=Application
</pre>
</div>
</div>
</div>

<div id="outline-container-org1cd399c" class="outline-2">
<h2 id="org1cd399c">环境变量与普通应用</h2>
<div class="outline-text-2" id="text-org1cd399c">
<p>
启动 ssh agent 要比添加 ssh 密匙提前。因为前者使用的是环境变量，后者使用的只是普通应用自启动。</p>
</div>
</div>
</div>
</body>
</html>