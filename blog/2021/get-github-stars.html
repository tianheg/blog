<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-11-20 Sat 19:26 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#一">1. 一、</a></li>
<li><a href="#二">2. 二、</a></li>
<li><a href="#使用的资源">3. 使用的资源</a></li>
</ul>
</div>
</div>
<p>
<del>+</del> date = '2020-12-09T13:36:47+08:00' description = '记录获得 GitHub 的
stars 的过程' keywords = ['GitHub', 'GitHub Actions'] tags = ['GitHub',
'GitHub Actions'] title = '怎样获得 GitHub 的 stars 列表' <del>+</del>
</p>

<p>
一直有一个想法：把 GitHub
上加星的仓库做成一个列表或者其他便于浏览查找的形式。今天，我就发现了这种工具。趁着午休，把它用上了，展示仓库：<a href="https://github.com/tianheg/stars">tianheg/stars</a>。
</p>

<p>
该仓库中包含的这个列表是基于一个名为 <code>starred</code> 的 pip 包生成的，再通过
GitHub Action
持续集成，达到每天自动生成列表的目的。该仓库地址：<a href="https://github.com/maguowei/starred">maguowei/starred</a>。
</p>

<p>
接下来记录整个过程：
</p>

<div id="outline-container-一" class="outline-2">
<h2 id="一"><span class="section-number-2">1</span> 一、</h2>
<div class="outline-text-2" id="text-一">
<p>
新建一个名字任意的仓库，新建文件名为 <code>ci.yml</code> 路径为
=~/.github/workflows/ci.yml=，并存放以下内容：
</p>

<pre class="example" id="org8065433">
name: update stars # GitHub Action 的名字
on:
  workflow_dispatch: # 为了手动部署，查看运行过程
  schedule:
    - cron: '00 0 * * *' # 定时：此时的时间是 08:00 CST – China Standard Time
jobs:
  awesome-stars:
    name: update awesome-stars
    runs-on: ubuntu-latest # 运行在最新的 Ubuntu 环境中，即 Ubuntu 20.04
    steps:
    - uses: actions/checkout@v1
    - name: Set up Python
      uses: actions/setup-python@v1
      with:
        python-version: 3.7 # 安装 3.7 版本的 python
    - name: Install dependencies # 更新 pip，安装 starred 包
      run: |
        python -m pip install --upgrade pip 
        pip install starred
    - name: update repo
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: starred --username tianheg --repository stars --sort --token ${GITHUB_TOKEN} --message 'stars update by github actions cron' # 执行生成 stars 列表的操作
</pre>

<p>
手动运行该 GitHub Action，即生成一个属于你自己的 stars 列表，这是我的：
</p>


<div id="orgf08d4d5" class="figure">
<p><img src="file:///images/get-github-stars.png" alt="get-github-stars.png" />
</p>
<p><span class="figure-number">Figure 1: </span>get-github-stars</p>
</div>
</div>
</div>

<div id="outline-container-二" class="outline-2">
<h2 id="二"><span class="section-number-2">2</span> 二、</h2>
<div class="outline-text-2" id="text-二">
<p>
我们来读读 <code>starred</code>
的代码，地址：<a href="https://github.com/maguowei/starred/blob/master/starred/starred.py">maguowei/starred/blob/master/starred/starred.py</a>：
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">!/usr/bin/env python</span>
<span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">-*- coding: utf-8 -*-</span>

<span style="font-weight: bold;">import</span> sys
<span style="font-weight: bold;">from</span> io <span style="font-weight: bold;">import</span> BytesIO
<span style="font-weight: bold;">from</span> collections <span style="font-weight: bold;">import</span> OrderedDict
<span style="font-weight: bold;">import</span> click
<span style="font-weight: bold;">from</span> github3 <span style="font-weight: bold;">import</span> GitHub
<span style="font-weight: bold;">from</span> github3.exceptions <span style="font-weight: bold;">import</span> NotFoundError
<span style="font-weight: bold;">from</span> starred <span style="font-weight: bold;">import</span> VERSION


<span style="font-weight: bold; font-style: italic;">desc</span> = <span style="font-style: italic;">'''# Awesome Stars [![Awesome](https://cdn.rawgit.com/sindresorhus/awesome/d730\</span>
<span style="font-style: italic;">5f38d29fed78fa85652e3a63e154dd8e8829/media/badge.svg)](https://github.com/sindresorhus/awesome)</span>

<span style="font-style: italic;">&gt; A curated list of my GitHub stars!  Generated by [starred](https://github.com/maguowei/starred)</span>


<span style="font-style: italic;">## Contents</span>
<span style="font-style: italic;">'''</span>

<span style="font-weight: bold; font-style: italic;">license_</span> = <span style="font-style: italic;">'''</span>
<span style="font-style: italic;">## License</span>

<span style="font-style: italic;">[![CC0](http://mirrors.creativecommons.org/presskit/buttons/88x31/svg/cc-zero.svg)]\</span>
<span style="font-style: italic;">(https://creativecommons.org/publicdomain/zero/1.0/)</span>

<span style="font-style: italic;">To the extent possible under law, [{username}](https://github.com/{username})\</span>
<span style="font-style: italic;"> has waived all copyright and related or neighboring rights to this work.</span>
<span style="font-style: italic;">'''</span>

<span style="font-weight: bold; font-style: italic;">html_escape_table</span> = {
    <span style="font-style: italic;">"&gt;"</span>: <span style="font-style: italic;">"&amp;gt;"</span>,
    <span style="font-style: italic;">"&lt;"</span>: <span style="font-style: italic;">"&amp;lt;"</span>,
}


<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">html_escape</span>(text):
    <span style="font-style: italic;">"""Produce entities within text."""</span>
    <span style="font-weight: bold;">return</span> <span style="font-style: italic;">""</span>.join(html_escape_table.get(c, c) <span style="font-weight: bold;">for</span> c <span style="font-weight: bold;">in</span> text)

<span style="font-weight: bold; text-decoration: underline;">@click.command</span>()
<span style="font-weight: bold; text-decoration: underline;">@click.option</span>(<span style="font-style: italic;">'--username'</span>, envvar=<span style="font-style: italic;">'USER'</span>, <span style="font-weight: bold;">help</span>=<span style="font-style: italic;">'GitHub username'</span>)
<span style="font-weight: bold; text-decoration: underline;">@click.option</span>(<span style="font-style: italic;">'--token'</span>, envvar=<span style="font-style: italic;">'GITHUB_TOKEN'</span>, <span style="font-weight: bold;">help</span>=<span style="font-style: italic;">'GitHub token'</span>)
<span style="font-weight: bold; text-decoration: underline;">@click.option</span>(<span style="font-style: italic;">'--sort'</span>,  is_flag=<span style="font-weight: bold; text-decoration: underline;">True</span>, <span style="font-weight: bold;">help</span>=<span style="font-style: italic;">'sort by language'</span>)
<span style="font-weight: bold; text-decoration: underline;">@click.option</span>(<span style="font-style: italic;">'--repository'</span>, default=<span style="font-style: italic;">''</span>, <span style="font-weight: bold;">help</span>=<span style="font-style: italic;">'repository name'</span>)
<span style="font-weight: bold; text-decoration: underline;">@click.option</span>(<span style="font-style: italic;">'--message'</span>, default=<span style="font-style: italic;">'update stars'</span>, <span style="font-weight: bold;">help</span>=<span style="font-style: italic;">'commit message'</span>)
<span style="font-weight: bold; text-decoration: underline;">@click.version_option</span>(version=VERSION, prog_name=<span style="font-style: italic;">'starred'</span>)
<span style="font-weight: bold;">def</span> <span style="font-weight: bold;">starred</span>(username, token, sort, repository, message):
    <span style="font-style: italic;">"""GitHub starred</span>

<span style="font-style: italic;">    creating your own Awesome List used GitHub stars!</span>

<span style="font-style: italic;">    example:</span>
<span style="font-style: italic;">        starred --username maguowei --sort &gt; README.md</span>
<span style="font-style: italic;">    """</span>
    <span style="font-weight: bold;">if</span> repository:
        <span style="font-weight: bold;">if</span> <span style="font-weight: bold;">not</span> token:
            click.secho(<span style="font-style: italic;">'Error: create repository need set --token'</span>, fg=<span style="font-style: italic;">'red'</span>)
            <span style="font-weight: bold;">return</span>
        <span style="font-weight: bold;">file</span> = BytesIO()
        <span style="font-weight: bold; font-style: italic;">sys.stdout</span> = <span style="font-weight: bold;">file</span>
    <span style="font-weight: bold;">else</span>:
        <span style="font-weight: bold;">file</span> = <span style="font-weight: bold; text-decoration: underline;">None</span>

    <span style="font-weight: bold; font-style: italic;">gh</span> = GitHub(token=token)
    <span style="font-weight: bold; font-style: italic;">stars</span> = gh.starred_by(username)
    click.echo(desc)
    <span style="font-weight: bold; font-style: italic;">repo_dict</span> = {}

    <span style="font-weight: bold;">for</span> s <span style="font-weight: bold;">in</span> stars:
        <span style="font-weight: bold; font-style: italic;">language</span> = s.language <span style="font-weight: bold;">or</span> <span style="font-style: italic;">'Others'</span>
        <span style="font-weight: bold; font-style: italic;">description</span> = html_escape(s.description).replace(<span style="font-style: italic;">'\n'</span>, <span style="font-style: italic;">''</span>) <span style="font-weight: bold;">if</span> s.description <span style="font-weight: bold;">else</span> <span style="font-style: italic;">''</span>
        <span style="font-weight: bold;">if</span> language <span style="font-weight: bold;">not</span> <span style="font-weight: bold;">in</span> repo_dict:
            <span style="font-weight: bold; font-style: italic;">repo_dict</span>[language] = []
        repo_dict[language].append([s.name, s.html_url, description.strip()])

    <span style="font-weight: bold;">if</span> sort:
        <span style="font-weight: bold; font-style: italic;">repo_dict</span> = OrderedDict(<span style="font-weight: bold;">sorted</span>(repo_dict.items(), key=<span style="font-weight: bold;">lambda</span> l: l[0]))

    <span style="font-weight: bold;">for</span> language <span style="font-weight: bold;">in</span> repo_dict.keys():
        <span style="font-weight: bold; font-style: italic;">data</span> = u<span style="font-style: italic;">'  - [{}](#{})'</span>.<span style="font-weight: bold;">format</span>(language, <span style="font-style: italic;">'-'</span>.join(language.lower().split()))
        click.echo(data)
    click.echo(<span style="font-style: italic;">''</span>)

    <span style="font-weight: bold;">for</span> language <span style="font-weight: bold;">in</span> repo_dict:
        click.echo(<span style="font-style: italic;">'## {} \n'</span>.<span style="font-weight: bold;">format</span>(language.replace(<span style="font-style: italic;">'#'</span>, <span style="font-style: italic;">'# #'</span>)))
        <span style="font-weight: bold;">for</span> repo <span style="font-weight: bold;">in</span> repo_dict[language]:
            <span style="font-weight: bold; font-style: italic;">data</span> = u<span style="font-style: italic;">'- [{}]({}) - {}'</span>.<span style="font-weight: bold;">format</span>(*repo)
            click.echo(data)
        click.echo(<span style="font-style: italic;">''</span>)

    click.echo(license_.<span style="font-weight: bold;">format</span>(username=username))

    <span style="font-weight: bold;">if</span> <span style="font-weight: bold;">file</span>:
        <span style="font-weight: bold;">try</span>:
            <span style="font-weight: bold; font-style: italic;">rep</span> = gh.repository(username, repository)
            <span style="font-weight: bold; font-style: italic;">readme</span> = rep.readme()
            readme.update(message, <span style="font-weight: bold;">file</span>.getvalue())
        <span style="font-weight: bold;">except</span> NotFoundError:
            <span style="font-weight: bold; font-style: italic;">rep</span> = gh.create_repository(repository, <span style="font-style: italic;">'A curated list of my GitHub stars!'</span>)
            rep.create_file(<span style="font-style: italic;">'README.md'</span>, <span style="font-style: italic;">'starred initial commit'</span>, <span style="font-weight: bold;">file</span>.getvalue())
        click.launch(rep.html_url)


<span style="font-weight: bold;">if</span> <span style="font-weight: bold;">__name__</span> == <span style="font-style: italic;">'__main__'</span>:
    starred()
</pre>
</div>

<ul class="org-ul">
<li>4 - 10 行是引用的类库</li>
<li>13 - 30 是生成的 README.md 中的文字叙述</li>
<li>42 - 48 是命令指示</li>
</ul>
</div>
</div>

<div id="outline-container-使用的资源" class="outline-2">
<h2 id="使用的资源"><span class="section-number-2">3</span> 使用的资源</h2>
<div class="outline-text-2" id="text-使用的资源">
<ul class="org-ul">
<li><a href="https://github.com/maguowei/starred">maguowei/starred</a></li>
<li><a href="https://github.com/maguowei/awesome-stars">maguowei/awesome-stars</a></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="postamble">First created:  <br />Last updated: 2021-11-20 Sat 19:13 <br />Power by <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.2 (<a href="https://orgmode.org">Org</a> mode 9.4.4)</p>
</div>
</body>
</html>