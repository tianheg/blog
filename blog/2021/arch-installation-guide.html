<!DOCTYPE html>
<html lang="zh">
<head>
<!-- 2021-11-30 Tue 07:44 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Arch 安装指南</title>
<meta name="generator" content="Org mode">
<meta name="description" content="Learn Technology, Love Life"
>
<meta name="keywords" content="博客, blog, 技术, 生活, Technology, Life">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" href="/theme/normalize.css"/>
<link rel="stylesheet" href="/theme/site.css"/>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC&display=swap" rel="stylesheet">
<script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "d5b841b503ed4d1b8fad459b84d1cc2f"}'></script>
<script defer src="/theme/link.js"></script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">Arch 安装指南</h1>
</header><nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#初始安装">1. 初始安装</a>
<ul>
<li><a href="#更改-bios使用-usb-系统启动盘优先启动">1.1. 更改 BIOS，使用 USB 系统启动盘优先启动</a></li>
<li><a href="#验证-uefi">1.2. 验证 UEFI</a></li>
<li><a href="#验证网络">1.3. 验证网络</a></li>
<li><a href="#更新系统时间">1.4. 更新系统时间</a></li>
<li><a href="#硬盘分区">1.5. 硬盘分区</a></li>
<li><a href="#硬盘格式化新建文件系统">1.6. 硬盘格式化、新建文件系统</a></li>
<li><a href="#挂载分区">1.7. 挂载分区</a></li>
<li><a href="#选择镜像源">1.8. 选择镜像源</a></li>
<li><a href="#安装基本系统和安装时要用的应用到硬盘">1.9. 安装基本系统和安装时要用的应用到硬盘</a></li>
</ul>
</li>
<li><a href="#配置系统">2. 配置系统</a>
<ul>
<li><a href="#进入硬盘而不在-u-盘">2.1. 进入硬盘，而不在 U 盘</a></li>
<li><a href="#生成挂载表">2.2. 生成挂载表</a></li>
<li><a href="#时区和语言">2.3. 时区和语言</a></li>
<li><a href="#安装引导程序">2.4. 安装引导程序</a></li>
<li><a href="#设置主机名">2.5. 设置主机名</a></li>
<li><a href="#提前配置网络">2.6. 提前配置网络</a></li>
<li><a href="#设置-root-密码">2.7. 设置 root 密码</a></li>
<li><a href="#新建普通用户">2.8. 新建普通用户</a></li>
<li><a href="#返回-u-盘">2.9. 返回 U 盘</a></li>
</ul>
</li>
<li><a href="#重启系统">3. 重启系统</a></li>
<li><a href="#完善系统">4. 完善系统</a>
<ul>
<li><a href="#启动微码更新">4.1. 启动微码更新</a></li>
<li><a href="#完善显卡驱动">4.2. 完善显卡驱动</a>
<ul>
<li><a href="#va-api-or-vdpau">4.2.1. VA-API or VDPAU</a></li>
</ul>
</li>
<li><a href="#安装图形界面">4.3. 安装图形界面</a></li>
<li><a href="#ssd-优化">4.4. SSD 优化</a>
<ul>
<li><a href="#开启trim">4.4.1. 开启TRIM</a></li>
<li><a href="#更换-io-scheduler">4.4.2. 更换 I/O  scheduler</a></li>
<li><a href="#迁移高读写文件到-tmpfs">4.4.3. 迁移高读写文件到 tmpfs</a></li>
</ul>
</li>
<li><a href="#检查硬盘状况">4.5. 检查硬盘状况</a></li>
<li><a href="#测试固态硬盘速度">4.6. 测试固态硬盘速度</a></li>
</ul>
</li>
<li><a href="#其他">5. 其他</a></li>
</ul>
</div>
</nav>
<p>
安装过程整体顺利，没有无法解决的问题，主要参考资料：
</p>

<ol class="org-ol">
<li><a href="https://io-oi.me/tech/hello-arch-linux/">https://io-oi.me/tech/hello-arch-linux/</a></li>
<li><a href="https://wiki.archlinux.org/">https://wiki.archlinux.org/</a></li>
<li>Google</li>
</ol>

<p>
除此之外，还有
<a href="https://python-archinstall.readthedocs.io/en/latest/index.html">archinstall</a>
</p>

<div id="outline-container-初始安装" class="outline-2">
<h2 id="初始安装"><span class="section-number-2">1</span> 初始安装</h2>
<div class="outline-text-2" id="text-初始安装">
</div>
<div id="outline-container-更改-bios使用-usb-系统启动盘优先启动" class="outline-3">
<h3 id="更改-bios使用-usb-系统启动盘优先启动"><span class="section-number-3">1.1</span> 更改 BIOS，使用 USB 系统启动盘优先启动</h3>
<div class="outline-text-3" id="text-更改-bios使用-usb-系统启动盘优先启动">
<p>
插入制作好的 arch linux USB 启动盘，当前目录下并无
install.txt（详见参考资料 1）。
</p>
</div>
</div>

<div id="outline-container-验证-uefi" class="outline-3">
<h3 id="验证-uefi"><span class="section-number-3">1.2</span> 验证 UEFI</h3>
<div class="outline-text-3" id="text-验证-uefi">
<p>
<code>ls /sys/firmware/efi/efivars</code> 有输出，说明启动模式为 UEFI。
</p>
</div>
</div>

<div id="outline-container-验证网络" class="outline-3">
<h3 id="验证网络"><span class="section-number-3">1.3</span> 验证网络</h3>
<div class="outline-text-3" id="text-验证网络">
<p>
<code>ping archlinux.org -c 3</code> 验证网络，0% packet loss 说明网络正常。
</p>
</div>
</div>

<div id="outline-container-更新系统时间" class="outline-3">
<h3 id="更新系统时间"><span class="section-number-3">1.4</span> 更新系统时间</h3>
<div class="outline-text-3" id="text-更新系统时间">
<p>
<code>timedatectl set-ntp true</code> 更新系统时间，=timedatectl status= 检查无误。
</p>
</div>
</div>

<div id="outline-container-硬盘分区" class="outline-3">
<h3 id="硬盘分区"><span class="section-number-3">1.5</span> 硬盘分区</h3>
<div class="outline-text-3" id="text-硬盘分区">
<ol class="org-ol">
<li><code>fdisk -l</code> 查看硬盘信息：sdb 119.24g 固态，sda 931.51g 机械</li>
<li><code>fdisk /dev/sdb</code> 固态硬盘分区</li>
</ol>

<p>
进入 fdisk 操作界面后，m 查看命令帮助，p 显示目标硬盘分区，g 新建 GPT
分区表。创建 sdb1 分区，n 创建分区、分区序号、类型起始扇区默认，结束扇区
+256M。修改分区类型为 EFI System，p 确认为 EFI System。创建 sdb2
分区，全部默认。我的安装移除了原系统的 signature。
</p>

<p>
分区结果：
</p>

<pre class="example" id="orgb7190c5">
Device      Start       End   Sectors  Size Type
/dev/sdb1    2048    526335    524288  256M EFI System
/dev/sdb2  526336 250069646 249543311  119G Linux filesystem
</pre>

<p>
关于是否分配 SWAP
分区的讨论：<a href="https://bbs.archlinuxcn.org/viewtopic.php?id=10472">https://bbs.archlinuxcn.org/viewtopic.php?id=10472</a>
</p>

<p>
机械硬盘 sda 作为挂载硬盘存储文件。
</p>
</div>
</div>

<div id="outline-container-硬盘格式化新建文件系统" class="outline-3">
<h3 id="硬盘格式化新建文件系统"><span class="section-number-3">1.6</span> 硬盘格式化、新建文件系统</h3>
<div class="outline-text-3" id="text-硬盘格式化新建文件系统">
<pre class="example" id="orgc8e5d1c">
mkfs.fat -F32 /dev/sdb1
mkfs.ext4 /dev/sdb2
mkfs.ext4 /dev/sda
</pre>
</div>
</div>

<div id="outline-container-挂载分区" class="outline-3">
<h3 id="挂载分区"><span class="section-number-3">1.7</span> 挂载分区</h3>
<div class="outline-text-3" id="text-挂载分区">
<pre class="example" id="org8dca2f3">
mount /dev/sdb2 /mnt
mkdir -p /mnt/boot/efi
mount /dev/sdb1 /mnt/boot/efi
</pre>
</div>
</div>

<div id="outline-container-选择镜像源" class="outline-3">
<h3 id="选择镜像源"><span class="section-number-3">1.8</span> 选择镜像源</h3>
<div class="outline-text-3" id="text-选择镜像源">
<pre class="example" id="org6cbffac">
pacman -Syyy reflector # reflector 能够方便地选择镜像源
reflector -c China -a 6 --sort rate --save /etc/pacman.d/mirrorlist # 这里的 mirrorlist 是 U 盘中的，还是硬盘中的？U 盘中的
pacman -Syyy # y 刷新本地缓存 yyy 强制刷新
</pre>
</div>
</div>

<div id="outline-container-安装基本系统和安装时要用的应用到硬盘" class="outline-3">
<h3 id="安装基本系统和安装时要用的应用到硬盘"><span class="section-number-3">1.9</span> 安装基本系统和安装时要用的应用到硬盘</h3>
<div class="outline-text-3" id="text-安装基本系统和安装时要用的应用到硬盘">
<pre class="example" id="org4282b38">
pacstrap -i /mnt base base-devel linux linux-firmware dhcpcd vim
</pre>
</div>
</div>
</div>

<div id="outline-container-配置系统" class="outline-2">
<h2 id="配置系统"><span class="section-number-2">2</span> 配置系统</h2>
<div class="outline-text-2" id="text-配置系统">
</div>
<div id="outline-container-进入硬盘而不在-u-盘" class="outline-3">
<h3 id="进入硬盘而不在-u-盘"><span class="section-number-3">2.1</span> 进入硬盘，而不在 U 盘</h3>
<div class="outline-text-3" id="text-进入硬盘而不在-u-盘">
<pre class="example" id="org0ddc78f">
arch-chroot /mnt /bin/bash
</pre>
</div>
</div>

<div id="outline-container-生成挂载表" class="outline-3">
<h3 id="生成挂载表"><span class="section-number-3">2.2</span> 生成挂载表</h3>
<div class="outline-text-3" id="text-生成挂载表">
<pre class="example" id="org96ed4ad">
genfstab -U -p /mnt &gt;&gt; /mnt/etc/fstab
</pre>

<p>
检查：
</p>

<pre class="example" id="org42110fd">
cat /mnt/etc/fstab
</pre>
</div>
</div>

<div id="outline-container-时区和语言" class="outline-3">
<h3 id="时区和语言"><span class="section-number-3">2.3</span> 时区和语言</h3>
<div class="outline-text-3" id="text-时区和语言">
<p>
设置时区：
</p>

<pre class="example" id="org75bc4c6">
ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
hwclock --systohc --utc
</pre>

<p>
配置系统语言环境:
</p>

<p>
<code>vim /etc/locale.gen</code> 取消注释：
</p>

<pre class="example" id="org22bb71d">
en_US.UTF-8 UTF-8
...
zh_CN.UTF-8 UTF-8
</pre>

<p>
生成配置：
</p>

<pre class="example" id="org0a9f29a">
locale-gen
</pre>

<p>
设置本地语言环境:
</p>

<p>
<code>vim /etc/locale.conf</code> 输入：
</p>

<pre class="example" id="org7280c8e">
LANG=en_US.UTF-8
</pre>
</div>
</div>

<div id="outline-container-安装引导程序" class="outline-3">
<h3 id="安装引导程序"><span class="section-number-3">2.4</span> 安装引导程序</h3>
<div class="outline-text-3" id="text-安装引导程序">
<pre class="example" id="org6ed1e9f">
pacman -S grub efibootmgr
grub-install --target=x86_64-efi --bootloader-id=GRUB --efi-directory=/boot/efi
grub-mkconfig -o /boot/grub/grub.cfg
</pre>

<p>
运行 grub
相关操作时，会出现警告：=Warning: os-prober will not be executed to detect other bootable partitions.=。查
arch wiki 后，可以在 /etc/default/grub 中设置
=GRUB_DISABLE_OS_PROBER=false=。
</p>
</div>
</div>

<div id="outline-container-设置主机名" class="outline-3">
<h3 id="设置主机名"><span class="section-number-3">2.5</span> 设置主机名</h3>
<div class="outline-text-3" id="text-设置主机名">
<pre class="example" id="org5a0d6a1">
echo arch &gt; /etc/hostname
</pre>

<p>
<code>vim /etc/hosts</code> 添加以下内容：
</p>

<pre class="example" id="org3c55ff0">
127.0.0.1 localhost
::1 localhost
127.0.0.1 arch.localdomain arch
</pre>
</div>
</div>

<div id="outline-container-提前配置网络" class="outline-3">
<h3 id="提前配置网络"><span class="section-number-3">2.6</span> 提前配置网络</h3>
<div class="outline-text-3" id="text-提前配置网络">
<pre class="example" id="org07ad7e8">
pacman -S networkmanager
systemctl enable NetworkManager
systemctl start NetworkManager
systemctl status NetworkManager # 检查是否运行
</pre>
</div>
</div>

<div id="outline-container-设置-root-密码" class="outline-3">
<h3 id="设置-root-密码"><span class="section-number-3">2.7</span> 设置 root 密码</h3>
<div class="outline-text-3" id="text-设置-root-密码">
<pre class="example" id="org4f92525">
passwd
</pre>
</div>
</div>

<div id="outline-container-新建普通用户" class="outline-3">
<h3 id="新建普通用户"><span class="section-number-3">2.8</span> 新建普通用户</h3>
<div class="outline-text-3" id="text-新建普通用户">
<pre class="example" id="org081c92b">
useradd -m -g users -G wheel -s /bin/bash archie
</pre>

<p>
设置普通用户密码：
</p>

<pre class="example" id="org38abe42">
passwd archie
</pre>

<p>
设置普通用户权限:
</p>

<pre class="example" id="org6cc3ac0">
EDITOR=vim visudo
</pre>

<p>
取消注释：
</p>

<pre class="example" id="org9bf427a">
## Uncomment to allow members of group wheel to execute any command

%wheel ALL=(ALL) ALL

## Same thing without a password

%wheel ALL=(ALL) NOPASSWD: ALL
</pre>
</div>
</div>

<div id="outline-container-返回-u-盘" class="outline-3">
<h3 id="返回-u-盘"><span class="section-number-3">2.9</span> 返回 U 盘</h3>
<div class="outline-text-3" id="text-返回-u-盘">
<pre class="example" id="orge577e2e">
exit
</pre>
</div>
</div>
</div>

<div id="outline-container-重启系统" class="outline-2">
<h2 id="重启系统"><span class="section-number-2">3</span> 重启系统</h2>
<div class="outline-text-2" id="text-重启系统">
<pre class="example" id="orgfb5eac0">
umount -R /mnt
reboot
</pre>

<p>
开机后改动 BIOS，配置「系统启动」后，拔掉 U 盘。普通用户 archie 登录。
</p>
</div>
</div>

<div id="outline-container-完善系统" class="outline-2">
<h2 id="完善系统"><span class="section-number-2">4</span> 完善系统</h2>
<div class="outline-text-2" id="text-完善系统">
</div>
<div id="outline-container-启动微码更新" class="outline-3">
<h3 id="启动微码更新"><span class="section-number-3">4.1</span> 启动微码更新</h3>
<div class="outline-text-3" id="text-启动微码更新">
<pre class="example" id="orgf179014">
sudo pacman -S intel-ucode
sudo grub-mkconfig -o /boot/grub/grub.cfg
</pre>
</div>
</div>

<div id="outline-container-完善显卡驱动" class="outline-3">
<h3 id="完善显卡驱动"><span class="section-number-3">4.2</span> 完善显卡驱动</h3>
<div class="outline-text-3" id="text-完善显卡驱动">
<p>
这一步要在知道自己显卡配置的前提下执行。
</p>
</div>

<div id="outline-container-va-api-or-vdpau" class="outline-4">
<h4 id="va-api-or-vdpau"><span class="section-number-4">4.2.1</span> VA-API or VDPAU</h4>
<div class="outline-text-4" id="text-va-api-or-vdpau">
<pre class="example" id="org9d5c4eb">
sudo pacman -S libva-utils vdpauinfo
vainfo
vdpauinfo
</pre>

<pre class="example" id="orgb177706">
vainfo: VA-API version: 1.12 (libva 2.12.0) vainfo: Driver
version: Intel iHD driver for Intel(R) Gen Graphics - 21.3.2 ()
vainfo: Supported profile and entrypoints VAProfileNone :
VAEntrypointVideoProc VAProfileNone : VAEntrypointStats
VAProfileMPEG2Simple : VAEntrypointVLD VAProfileMPEG2Simple :
VAEntrypointEncSlice VAProfileMPEG2Main : VAEntrypointVLD
VAProfileMPEG2Main : VAEntrypointEncSlice VAProfileH264Main :
VAEntrypointVLD VAProfileH264Main : VAEntrypointEncSlice
VAProfileH264Main : VAEntrypointFEI VAProfileH264Main :
VAEntrypointEncSliceLP VAProfileH264High : VAEntrypointVLD
VAProfileH264High : VAEntrypointEncSlice VAProfileH264High :
VAEntrypointFEI VAProfileH264High : VAEntrypointEncSliceLP
VAProfileVC1Simple : VAEntrypointVLD VAProfileVC1Main :
VAEntrypointVLD VAProfileVC1Advanced : VAEntrypointVLD
VAProfileJPEGBaseline : VAEntrypointVLD VAProfileJPEGBaseline :
VAEntrypointEncPicture VAProfileH264ConstrainedBaseline:
VAEntrypointVLD VAProfileH264ConstrainedBaseline: VAEntrypointEncSlice
VAProfileH264ConstrainedBaseline: VAEntrypointFEI
VAProfileH264ConstrainedBaseline: VAEntrypointEncSliceLP
VAProfileVP8Version0\_3 : VAEntrypointVLD VAProfileVP8Version0\_3 :
VAEntrypointEncSlice VAProfileHEVCMain : VAEntrypointVLD
VAProfileHEVCMain : VAEntrypointEncSlice VAProfileHEVCMain :
VAEntrypointFEI VAProfileHEVCMain10 : VAEntrypointVLD
VAProfileHEVCMain10 : VAEntrypointEncSlice VAProfileVP9Profile0 :
VAEntrypointVLD VAProfileVP9Profile2 : VAEntrypointVLD

display: :0 screen: 0 Failed to open VDPAU backend
libvdpau\_va\_gl.so: cannot open shared object file: No such file or
directory Error creating VDPAU device: 1
</pre>

<p>
So mine is VA-API, I supposed to install
<a href="https://wiki.archlinux.org/title/Hardware_video_acceleration#:~:text=VA-API%20on%20Radeon%20HD%202000%20and%20newer%20GPUs">libva-mesa-driver</a>.
</p>

<p>
我的两种 GPU：
</p>

<p>
00:02.0 VGA compatible controller: Intel Corporation UHD Graphics 620
(rev 07) 01:00.0 Display controller: Advanced Micro Devices, Inc.
[AMD/ATI] Topaz XT [Radeon R7 M260/M265 / M340/M360 / M440/M445 /
530/535 / 620/625 Mobile] (rev c3)
</p>

<ul class="org-ul">
<li>Radeon R7 M260(Topaz)
<a href="https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units#Radeon_R5/R7/R9_M200_series">https://en.wikipedia.org/wiki/List_of_AMD_graphics_processing_units#Radeon_R5/R7/R9_M200_series</a></li>
</ul>

<pre class="example" id="org68192ae">
sudo pacman -S xf86-video-intel intel-media-driver vulkan-intel xf86-video-amdgpu xf86-video-ati mesa-vdpau vulkan-radeon
</pre>

<p>
不推荐安装 =xf86-video-intel=，详见
<a href="https://wiki.archlinux.org/title/Intel_graphics#:~:text=Often%20not%20recommended%2C%20see%20note%20below">Intel
graphics - ArchWiki</a>
</p>

<p>
CPU
的详细信息：<a href="https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units#:~:text=38.4-,Core%20i5-8250U,-Core%20i5-8350U">https://en.wikipedia.org/wiki/List_of_Intel_graphics_processing_units#:~:text=38.4-,Core%20i5-8250U,-Core%20i5-8350U</a>
</p>

<p>
HDMI audio:
<a href="https://wiki.archlinux.org/title/ATI#:~:text=HDMI%20audio%20is%20supported">https://wiki.archlinux.org/title/ATI#:~:text=HDMI%20audio%20is%20supported</a>
</p>

<p>
ref:
</p>

<ol class="org-ol">
<li><a href="https://wiki.archlinux.org/title/Hardware_video_acceleration">https://wiki.archlinux.org/title/Hardware_video_acceleration</a></li>
<li><a href="https://wiki.archlinux.org/title/Vulkan">https://wiki.archlinux.org/title/Vulkan</a></li>
<li><a href="https://wiki.archlinux.org/title/Xorg#Driver_installation">https://wiki.archlinux.org/title/Xorg#Driver_installation</a></li>
<li><a href="https://wiki.archlinux.org/title/Hardware_video_acceleration#:~:text=VDPAU%20on%20Radeon%20R300%20and%20newer%20GPUs">https://wiki.archlinux.org/title/Hardware_video_acceleration#:~:text=VDPAU%20on%20Radeon%20R300%20and%20newer%20GPUs</a></li>
</ol>
</div>
</div>
</div>

<div id="outline-container-安装图形界面" class="outline-3">
<h3 id="安装图形界面"><span class="section-number-3">4.3</span> 安装图形界面</h3>
<div class="outline-text-3" id="text-安装图形界面">
<pre class="example" id="orgfeb8065">
sudo pacman -S xorg xorg-server xorg-xinit plasma # gnome gnome-extra
# systemctl enable gdm
systemctl enable sddm # for kde(plasma)
</pre>

<p>
桌面环境为 GNOME 时，切换 Wayland 至 Xorg：
</p>

<pre class="example" id="orgc4bee23">
sudo vim /etc/gdm/custom.conf
</pre>

<p>
<code>/etc/gdm/custom.conf</code>:
</p>

<pre class="example" id="org0a3705b">
[daemon]
# Uncoment the line below to force the login screen to use Xorg
-#WaylandEnable=false
+WaylandEnable=false
</pre>

<p>
重启后，图形界面打开，但无法打开 Gnome Terminal，通过 Ctrl+Alt+F2
进入命令行模式，输入 gnome-terminal 显示：
</p>

<pre class="example" id="org2c29584">
# Locale not supported by C library.
# Using the fallback 'C' locale
Unable to init server: Could not connect: Connection refused
# Failed to parse arguments: Cannot open display!
</pre>

<p>
解决：在配置系统语言环境时，选择了 es_US，而不是 en_US。
</p>
</div>
</div>

<div id="outline-container-ssd-优化" class="outline-3">
<h3 id="ssd-优化"><span class="section-number-3">4.4</span> SSD 优化</h3>
<div class="outline-text-3" id="text-ssd-优化">
</div>
<div id="outline-container-开启trim" class="outline-4">
<h4 id="开启trim"><span class="section-number-4">4.4.1</span> 开启TRIM</h4>
<div class="outline-text-4" id="text-开启trim">
<p>
一定要确认固态硬盘是否支持，否则别用。会导致数据丢失
</p>

<p>
查看是否支持：=lsblk &#x2013;discard= 如果输出的 DISC-GRAN 和 DISC-MAX 不为
0，则表明支持。
</p>

<pre class="example" id="org730df44">
sudo vim /etc/fstab
</pre>

<p>
添加 noatime 和 diacard：
</p>

<pre class="example" id="orgc2a2870">
# &lt;file system&gt; &lt;dir&gt; &lt;type&gt; &lt;options&gt; &lt;dump&gt; &lt;pass&gt;
# /dev/sdb2
UUID=b182ad17-2f74-4bf0-95b6-a42884a4ff79 /          ext4       rw,noatime,discard 0 1

# /dev/sdb1
UUID=EF6F-2E0C       /boot/efi  vfat       rw,noatime,discard,fmask=0022,dmask=0022,codepage=437,iocharset=ascii,shortname=mixed,utf8,errors=remount-ro 0 2
</pre>
</div>
</div>

<div id="outline-container-更换-io-scheduler" class="outline-4">
<h4 id="更换-io-scheduler"><span class="section-number-4">4.4.2</span> 更换 I/O  scheduler</h4>
<div class="outline-text-4" id="text-更换-io-scheduler">
<pre class="example" id="org395fcab">
sudo vim /etc/default/grub
</pre>

<p>
找到 <code>GRUB_CMDLINE_LINUX_DEFAULT</code> 这一行，添加 <code>elevator=noop</code>:
</p>

<pre class="example" id="org7fb083b">
GRUB_CMDLINE_LINUX_DEFAULT="elevator=noop loglevel=3 quiet"
</pre>

<pre class="example" id="org13d1bac">
sudo grub-mkconfig -o /boot/grub/grub.cfg
</pre>
</div>
</div>

<div id="outline-container-迁移高读写文件到-tmpfs" class="outline-4">
<h4 id="迁移高读写文件到-tmpfs"><span class="section-number-4">4.4.3</span> 迁移高读写文件到 tmpfs</h4>
<div class="outline-text-4" id="text-迁移高读写文件到-tmpfs">
<pre class="example" id="org6da49af">
sudo vim /etc/fstab
</pre>

<p>
添加以下内容到最后：
</p>

<pre class="example" id="org2904386">
tmpfs  /tmp    tmpfs   defaults,noatime,mode=1777 0 0
tmpfs  /var/log    tmpfs   defaults,noatime,mode=1777 0 0
tmpfs  /var/tmp    tmpfs   defaults,noatime,mode=1777 0 0
</pre>

<p>
将 Google Chrome 的缓存挂载到 /tmp（后因排查
<a href="https://github.com/tianheg/blog/issues/147">arch linux system freeze
after connecting wifi</a> 问题取消挂载）：
</p>

<pre class="example" id="org15afa95">
cd ~/.cache/google-chrome/Default/ &amp;&amp; rm -rf Cache &amp;&amp; ln -sf /tmp Cache
cd ~/.cache/google-chrome/Default/ &amp;&amp; unlink Cache # 取消 Symbolic Link
</pre>
</div>
</div>
</div>

<div id="outline-container-检查硬盘状况" class="outline-3">
<h3 id="检查硬盘状况"><span class="section-number-3">4.5</span> 检查硬盘状况</h3>
<div class="outline-text-3" id="text-检查硬盘状况">
<pre class="example" id="org22d7a6d">
sudo pacman -S hdparm smartmontools
sudo hdparm -I /dev/sdb
sudo smartctl -t short /dev/sdb
</pre>
</div>
</div>

<div id="outline-container-测试固态硬盘速度" class="outline-3">
<h3 id="测试固态硬盘速度"><span class="section-number-3">4.6</span> 测试固态硬盘速度</h3>
<div class="outline-text-3" id="text-测试固态硬盘速度">
<pre class="example" id="org34bf3bb">
sudo dd if=/dev/zero of=/tmp/test.img bs=1G count=1 oflag=dsync
</pre>

<p>
至此系统完善到此告一段落。
</p>
</div>
</div>
</div>

<div id="outline-container-其他" class="outline-2">
<h2 id="其他"><span class="section-number-2">5</span> 其他</h2>
<div class="outline-text-2" id="text-其他">
<ul class="org-ul">
<li><a href="https://nyac.at/4">在阿里云服务器上安装 Arch Linux</a></li>
</ul>
</div>
</div>
</div>
</body>
</html>