{{ define "main" }}
  {{ if .TableOfContents }}
  <!-- Desktop TOC Sidebar -->
  <aside class="toc-sidebar">
    <nav aria-label="Table of contents" class="toc">
      <h2 class="toc-title">Contents</h2>
      <div class="toc-content">
        {{ .TableOfContents }}
      </div>
    </nav>
  </aside>

  <!-- Mobile TOC Button -->
  <button class="toc-mobile-button" aria-label="Open table of contents" type="button">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
    <span>Contents</span>
  </button>

  <!-- Mobile TOC Overlay -->
  <div class="toc-mobile-overlay" aria-hidden="true"></div>

  <!-- Mobile TOC Drawer -->
  <aside class="toc-mobile-drawer" aria-label="Table of contents">
    <div class="toc-mobile-header">
      <h2 class="toc-title">Contents</h2>
      <button class="toc-mobile-close" aria-label="Close table of contents" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <nav class="toc-mobile-content">
      <div class="toc-content">
        {{ .TableOfContents }}
      </div>
    </nav>
  </aside>
  {{ end }}

<article data-pagefind-body>
  {{ if eq .Section "til" }}
  <!-- Breadcrumb Navigation -->
  <nav aria-label="breadcrumb" class="mb-6">
    <ul class="flex list-none items-center text-sm text-gray-600 dark:text-gray-400">
      <li class="flex items-center space-x-2">
        <span class="text-gray-400">/</span>
        <a href="/til/" class="hover:text-gray-900 dark:hover:text-gray-200 transition-colors">
          TIL
        </a>
      </li>

      {{ if .File }}
        {{ $category := index (split .File.Dir "/") 1 }}
        {{ if and $category (ne $category "_index.org") }}
          <li class="flex items-center space-x-2">
            <span class="text-gray-400">/</span>
            <a href="/til/#{{ $category | urlize }}" class="hover:text-gray-900 dark:hover:text-gray-200 transition-colors">
              {{ $category | title }}
            </a>
          </li>
        {{ end }}
      {{ end }}

      <li class="flex items-center space-x-2">
        <span class="text-gray-400">/</span>
        <span class="text-gray-900 dark:text-gray-100 font-medium">
          {{- if .Title -}}
            {{- .Title -}}
          {{- else if .RawContent -}}
            {{- $firstLine := index (split .RawContent "\n") 0 -}}
            {{- if (hasPrefix $firstLine "* ") -}}
              {{- trim (strings.TrimPrefix "* " $firstLine) " " -}}
            {{- else -}}
              {{- .Params.title -}}
            {{- end -}}
          {{- else -}}
            {{- .Params.title -}}
          {{- end -}}
        </span>
      </li>
    </ul>
  </nav>
  {{ end }}

  <h1>{{ .Title }}</h1>
  <p>
    {{ if eq .Section "posts" }}
    <time datetime='{{ .Date.Format "2006-01-02" }}'>
      {{ .Date.Format (default "02 Jan, 2006" .Site.Params.dateFormat) }}
    </time>
    {{ end }}
  </p>
  <div>
    {{ $content := .Content }}
    {{ $baseURL := cond hugo.IsProduction .Site.BaseURL "http://localhost:1313/" }}
    {{ $content = $content | replaceRE `<a href="(https?://[^"]+)"` `<a href="$1" target="_blank" rel="noreferrer"` }}
    {{ $content | safeHTML }}
  </div>
    {{ if eq .Section "posts" }}
    <hr>
    {{ end }}

    {{ partial "edit-link.html" . }}
</article>

  {{ partial "minimal-footer.html" . }}
  {{ partial "comments.html" . }}
{{ end }}
